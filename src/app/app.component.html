<div class="w-full min-h-screen">
  <p-toast />
  <ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="large" color="rgb(107 203 91)" type="ball-spin-clockwise-fade"
    [fullScreen]="true">
    <p class="text-green-500 text-2xl"> Loading... </p>
  </ngx-spinner>

  <!-- Main Content Area -->
  <div class="card main header z-50">
    <!-- <p-menubar [model]="items" /> -->
    <p-toolbar [styleClass]="auth.isLoggedIn ? '!p-0' : '!p-2' + ' !bg-emerald-50'" [style]="" class="!bg-indigo-500">
      <ng-template #start>
        <div class="flex justify-between items-center md:gap-10">
          <div class="flex items-center">
            <a href="#">
              <span class="flex flex-row justify-center items-center gap-1 font-bold tracking-wider">
                <!-- <img src="../assets/logo2.png" alt="logo" height="40px"> -->
                <img src="../assets/logo_rf.png" alt="logo" class="w-12 h-6">
                <p class="hidden sm:block text-xl text-emerald-600">ReportsForge</p>
              </span>
            </a>
          </div>

          <!-- Desktop Menu (hidden on small) -->
          <div *ngIf="auth?.isLoggedIn" class="hidden lg:flex gap-2 items-center">
            <p-button icon="pi pi-home" label="Dashboard" [routerLink]="['/dashboard']" text severity="primary" />
            <p-button icon="pi pi-folder-open" label="Template Builder" [routerLink]="['/templates']" text
              severity="primary" />
            <p-button icon="pi pi-file-pdf" label="Your Reports" [routerLink]="['/reports']" text severity="primary" />
            <p-button icon="pi pi-cog" label="Settings" [routerLink]="['/settings']" text severity="primary" />
          </div>

          <!-- Mobile Menu Toggle (hidden on md and up) -->
          <div *ngIf="auth?.isLoggedIn"  class="lg:hidden">
            <p-button icon="pi pi-bars" text (click)="mobileMenu?.toggle($event)" />
            <p-menu #mobileMenu [model]="mobileMenuItems" popup />
          </div>
        </div>
      </ng-template>


      <ng-template #end>
        <div *ngIf="userInfo?.email" class="flex gap-2 items-center">
          <p-button icon="pi pi-question-circle" raised text aria-label="Help" />
          <p-button (click)="toggleDarkMode()" [icon]="isDark ? 'pi pi-sun': 'pi pi-moon'" outlined text raised />
          <!-- Notification Bell with Badge -->
          <div class="relative inline-block">
            <p-button icon="pi pi-bell" raised text (click)="op.toggle($event)" aria-label="Notifications" />
            <span *ngIf="notifications.length > 0"
              class="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white dark:border-gray-800">
            </span>
          </div>

          <p-button class="flex items-center gap-2" text plain (click)="drawerOpen=true" severity="primary">
            <p-avatar *ngIf="userInfo?.picture" size="large" [image]="userInfo.picture" shape="circle"
              [ngStyle]="{ 'width': '45px', 'height': '45px' }">
            </p-avatar>

            <div class="hidden lg:flex flex-col justify-start items-start">
              <span>{{userInfo?.name}}</span>
              <span>{{userInfo?.email}}</span>
            </div>
          </p-button>
        </div>
      </ng-template>
    </p-toolbar>
  </div>

  <div class="main contents">
    <section class="w-full absolute top-[10%] bottom-[10%] px-5">
      <router-outlet></router-outlet>
    </section>
  </div>

  <!-- Footer -->
  <mat-toolbar *ngIf="auth?.isLoggedIn" class="main footer bg-white dark:bg-black text-black dark:text-white">
    <div class="flex justify-between items-center w-full">
      <span>Made for You - ReportsForge</span>
      <span>Â© 2025 ReportsForge</span>
    </div>
  </mat-toolbar>

</div>



<p-drawer header="Welcome, {{userInfo?.name}}" [(visible)]="drawerOpen" position="right">
  <div class="!w-full flex flex-col justify-between items-start">
    <p>{{userInfo?.email}}</p>
    <p-button styleClass="!w-full" raised class="!w-full" icon="pi pi-sign-out" label="Log Out" severity="danger"
      (click)="logout(); drawerOpen=false"></p-button>
  </div>
</p-drawer>


<!-- Overlay Panel -->
<p-overlayPanel #op [showCloseIcon]="true" styleClass="w-96 shadow-lg rounded-xl overflow-hidden dark:bg-gray-800">
  <div class="p-4 space-y-4">

    <!-- Welcome Header -->
    <div class="flex items-center gap-3">
      <i class="pi pi-inbox text-2xl text-blue-500"></i>
      <div>
        <div class="font-bold text-lg">Welcome back!</div>
        <div class="text-sm text-gray-500 dark:text-gray-400">Here are your recent notifications.</div>
      </div>
    </div>

    <div *ngIf="notifications.length > 0; else noNotifs" class="space-y-3 max-h-80 overflow-y-auto">
      <!-- Notification List -->
      <div *ngFor="let notif of notifications; let i = index"
        class="border border-gray-200 dark:border-gray-700 rounded-lg p-3 flex justify-between items-start gap-3 bg-white dark:bg-gray-900">
        <div class="flex items-start gap-3">
          <i [ngClass]="getIconClass(notif.title)"  class="text-xl text-primary-500 mt-1"></i>
          <div>
            <div class="font-semibold text-sm">{{ notif.title }}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">{{ getRelativeTime(notif.created_at) }}</div>
            <div class="text-sm text-gray-700 dark:text-gray-300">{{ notif.details }}</div>
          </div>
        </div>
        <button pButton type="button" icon="pi pi-times" text class="!p-0 !m-0" (click)="clearNotification(i)"
          aria-label="Clear notification">
        </button>
      </div>
    </div>

    <!-- No Notifications -->
    <ng-template #noNotifs>
      <div class="text-center text-sm text-gray-500 dark:text-gray-400 py-4">
        <i class="pi pi-check-circle text-green-500 text-xl block mb-2"></i>
        You're all caught up!
      </div>
    </ng-template>

    <!-- Clear All Button -->
    <div *ngIf="notifications.length > 0" class="pt-2">
      <button pButton label="Clear All" icon="pi pi-trash" class="w-full" severity="danger" (click)="clearAll()">
      </button>
    </div>

  </div>
</p-overlayPanel>